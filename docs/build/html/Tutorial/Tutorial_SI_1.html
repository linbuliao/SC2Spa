<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Map single cells to Space (Slide-seqV2 Mouse Hippocampus) &mdash; SC2Spa 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tutorials" href="../Tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> SC2Spa
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../Tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Map single cells to Space (Slide-seqV2 Mouse Hippocampus)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Download-datasets">Download datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Load-datasets">Load datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Select-genes-using-Wasserstein-distance-(Optional)">Select genes using Wasserstein distance (Optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fine-Mapping">Fine Mapping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Train-SC2Spa-with-the-genes-selected-based-on-Wassertain-distance">Train SC2Spa with the genes selected based on Wassertain distance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Train-SC2Spa-with-all-genes-shared-by-the-single-cell-and-spatial-transcriptomic-data">Train SC2Spa with all genes shared by the single-cell and spatial transcriptomic data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Imputation">Imputation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Spatially-Variable-Genes">Spatially Variable Genes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SC2Spa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../Tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Map single cells to Space (Slide-seqV2 Mouse Hippocampus)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Tutorial/Tutorial_SI_1.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Map-single-cells-to-Space-(Slide-seqV2-Mouse-Hippocampus)">
<h1>Map single cells to Space (Slide-seqV2 Mouse Hippocampus)<a class="headerlink" href="#Map-single-cells-to-Space-(Slide-seqV2-Mouse-Hippocampus)" title="Permalink to this headline"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">import</span> <span class="nn">anndata</span> <span class="k">as</span> <span class="nn">ad</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">from</span> <span class="nn">SC2Spa</span> <span class="kn">import</span> <span class="n">SI</span><span class="p">,</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Vis</span><span class="p">,</span> <span class="n">SVA</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">seed</span>
<span class="kn">from</span> <span class="nn">tensorflow.random</span> <span class="kn">import</span> <span class="n">set_seed</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-03-14 17:32:57.923494: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-03-14 17:32:58.887217: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-11.6/lib64
2023-03-14 17:32:58.887303: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-11.6/lib64
2023-03-14 17:32:58.887310: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">SC2Spa</span>

<span class="nb">print</span><span class="p">(</span><span class="n">SC2Spa</span><span class="o">.</span><span class="n">__all__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Version:&#39;</span><span class="p">,</span> <span class="n">SC2Spa</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;__title__&#39;, &#39;__summary__&#39;, &#39;__uri__&#39;, &#39;__version__&#39;, &#39;__author__&#39;, &#39;__email__&#39;, &#39;__license__&#39;, &#39;__copyright__&#39;]
********************
Version: 1.1.5
</pre></div></div>
</div>
<section id="Download-datasets">
<h2>Download datasets<a class="headerlink" href="#Download-datasets" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;Dataset&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;Dataset&#39;</span><span class="p">)</span>
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38736651<span class="w"> </span>-O<span class="w"> </span>Dataset/AdataMH1.h5ad
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38738136<span class="w"> </span>-O<span class="w"> </span>Dataset/AMB_HC.h5ad
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38756529<span class="w"> </span>-O<span class="w"> </span>Dataset/ssHippo_RCTD.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2023-01-24 19:02:05--  https://figshare.com/ndownloader/files/38736651
Resolving figshare.com (figshare.com)... 52.51.33.13, 54.229.244.39, 2a05:d018:1f4:d003:e01c:5f24:fcad:4854, ...
Connecting to figshare.com (figshare.com)|52.51.33.13|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38736651/AdataMH1.h5ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T180205Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=707e4f23f121415d52c1dab8b3e707d95df4ac571f540fb86d5be761edda42ab [following]
--2023-01-24 19:02:05--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38736651/AdataMH1.h5ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T180205Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=707e4f23f121415d52c1dab8b3e707d95df4ac571f540fb86d5be761edda42ab
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.100.35, 52.92.17.88, 52.218.36.194, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.100.35|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 73481745 (70M) [application/octet-stream]
Saving to: ‘Dataset/AdataMH1.h5ad’

Dataset/AdataMH1.h5 100%[===================&gt;]  70.08M  16.5MB/s    in 4.3s

2023-01-24 19:02:10 (16.4 MB/s) - ‘Dataset/AdataMH1.h5ad’ saved [73481745/73481745]

--2023-01-24 19:02:10--  https://figshare.com/ndownloader/files/38738136
Resolving figshare.com (figshare.com)... 54.229.244.39, 52.51.33.13, 2a05:d018:1f4:d000:a2bd:ffac:4123:16e9, ...
Connecting to figshare.com (figshare.com)|54.229.244.39|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38738136/AMB_HC.h5ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T180210Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=4e1526450439464860b9e701961f56fe0cc70ca64986c9e4933dfff62cacdbf7 [following]
--2023-01-24 19:02:10--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38738136/AMB_HC.h5ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T180210Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=4e1526450439464860b9e701961f56fe0cc70ca64986c9e4933dfff62cacdbf7
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.92.32.96, 52.218.112.179, 52.218.41.251, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.92.32.96|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 334743216 (319M) [application/octet-stream]
Saving to: ‘Dataset/AMB_HC.h5ad’

Dataset/AMB_HC.h5ad 100%[===================&gt;] 319.24M  27.1MB/s    in 15s

2023-01-24 19:02:25 (21.5 MB/s) - ‘Dataset/AMB_HC.h5ad’ saved [334743216/334743216]

--2023-01-24 19:02:25--  https://figshare.com/ndownloader/files/38756529
Resolving figshare.com (figshare.com)... 54.229.244.39, 52.51.33.13, 2a05:d018:1f4:d000:a2bd:ffac:4123:16e9, ...
Connecting to figshare.com (figshare.com)|54.229.244.39|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38756529/ssHippo_RCTD.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T180225Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=b193bef70a79f0cc0f52f3db99adb8362f86f9b290ca5b5db06e9ff72688dd36 [following]
--2023-01-24 19:02:26--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38756529/ssHippo_RCTD.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T180225Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=b193bef70a79f0cc0f52f3db99adb8362f86f9b290ca5b5db06e9ff72688dd36
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.101.235, 52.218.101.51, 52.218.60.75, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.101.235|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1357460 (1.3M) [text/csv]
Saving to: ‘Dataset/ssHippo_RCTD.csv’

Dataset/ssHippo_RCT 100%[===================&gt;]   1.29M  5.18MB/s    in 0.2s

2023-01-24 19:02:26 (5.18 MB/s) - ‘Dataset/ssHippo_RCTD.csv’ saved [1357460/1357460]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;tutorial1&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;tutorial1&#39;</span><span class="p">)</span>
<span class="c1">#%cd tutorial1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/mnt/win1/SC2Spa_Notebook
</pre></div></div>
</div>
</section>
<section id="Load-datasets">
<h2>Load datasets<a class="headerlink" href="#Load-datasets" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Load</span>
<span class="n">adata_ref</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s1">&#39;Dataset/AdataMH1.h5ad&#39;</span><span class="p">)</span>
<span class="n">adata_query</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s1">&#39;Dataset/AMB_HC.h5ad&#39;</span><span class="p">)</span>

<span class="n">adata_ref</span><span class="o">.</span><span class="n">var_names</span> <span class="o">=</span> <span class="n">adata_ref</span><span class="o">.</span><span class="n">var_names</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">var_names</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">var_names</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="n">adata_ref</span><span class="o">.</span><span class="n">var_names_make_unique</span><span class="p">()</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">var_names_make_unique</span><span class="p">()</span>

<span class="c1">#Normalize</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">normalize_total</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">target_sum</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">normalize_total</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">target_sum</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">adata_query</span><span class="p">)</span>

<span class="c1">#Load annotation</span>
<span class="n">Anno</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset/ssHippo_RCTD.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;MCT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
<span class="n">index1</span> <span class="o">=</span> <span class="n">Anno</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_2&#39;</span><span class="p">])]</span>
<span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;MCT&#39;</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_1&#39;</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span>
<span class="n">index2</span> <span class="o">=</span> <span class="n">Anno</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_2&#39;</span><span class="p">])]</span>
<span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;MCT&#39;</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_1&#39;</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">Anno</span><span class="p">[</span><span class="s1">&#39;celltype_2&#39;</span><span class="p">][</span><span class="n">index2</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)))))</span>
<span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span> <span class="o">=</span> <span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">Anno</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">adata_ref</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[[</span><span class="s1">&#39;xcoord&#39;</span><span class="p">,</span> <span class="s1">&#39;ycoord&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>



<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;common_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;common_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;simp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;common_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                        <span class="n">expand</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; \(&#39;</span><span class="p">,</span>
                                    <span class="n">expand</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;cortexm&#39;</span><span class="p">,</span> <span class="s1">&#39;cortex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Medial entorrhinal cortex&#39;</span><span class="p">,</span> <span class="s1">&#39;Medial entorhinal cortex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/linbuliao/anaconda3/lib/python3.9/site-packages/anndata/_core/anndata.py:1830: UserWarning: Variable names are not unique. To make them unique, call `.var_names_make_unique`.
  utils.warn_names_duplicates(&#34;var&#34;)
/tmp/ipykernel_104483/2707152110.py:30: FutureWarning: The default value of regex will change from True to False in a future version. In addition, single character regular expressions will *not* be treated as literal strings when regex=True.
  adata_query.obs[&#39;common_name&#39;] = adata_query.obs[&#39;common_name&#39;].str.replace(&#39;?&#39;, &#39;&#39;)
</pre></div></div>
</div>
</section>
<section id="Select-genes-using-Wasserstein-distance-(Optional)">
<h2>Select genes using Wasserstein distance (Optional)<a class="headerlink" href="#Select-genes-using-Wasserstein-distance-(Optional)" title="Permalink to this headline"></a></h2>
<p>This step is time-consuming for Slide-seqV2 data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">sta = time()</span>
<span class="sd">JGs, WDs = SI.WassersteinD(adata_ref, adata_query, sparse = True,</span>
<span class="sd">                           WD_cutoff = 0.1, root = &#39;WDs/&#39;, save = &#39;WDs_T2&#39;)</span>

<span class="sd">end = time()</span>
<span class="sd">print((end - sta) / 60.0, &#39;min&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">root = &#39;WDs/&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">WD_cutoff</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/&#39;</span>
<span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;WDs_T2&#39;</span>

<span class="c1"># Download the precalculated Wasserstain distances between the scRNA-seq and ST datasets.</span>
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38938874<span class="w"> </span>-O<span class="w"> </span>tutorial1/WDs_T2.csv

<span class="n">WDs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="n">save</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
<span class="n">JGs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">WDs</span><span class="p">[</span><span class="n">WDs</span><span class="p">[</span><span class="s1">&#39;Wasserstein_Distance&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">WD_cutoff</span><span class="p">][</span><span class="s1">&#39;Gene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2023-03-13 16:01:34--  https://figshare.com/ndownloader/files/38938874
Resolving figshare.com (figshare.com)... 34.240.113.119, 63.35.25.157, 2a05:d018:1f4:d000:8f2d:b761:e885:37ef, ...
Connecting to figshare.com (figshare.com)|34.240.113.119|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38938874/WDs_T2.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230313/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230313T150134Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=bfcf853d1c174c3690b0356f58f6d398df26a09050ce1409d0b9a6648b702c76 [following]
--2023-03-13 16:01:34--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38938874/WDs_T2.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230313/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230313T150134Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=bfcf853d1c174c3690b0356f58f6d398df26a09050ce1409d0b9a6648b702c76
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.118.72, 52.92.2.216, 52.92.16.200, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.118.72|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 562050 (549K) [text/csv]
Saving to: ‘tutorial1/WDs_T2.csv’

tutorial1/WDs_T2.cs 100%[===================&gt;] 548.88K  --.-KB/s    in 0.1s

2023-03-13 16:01:35 (3.73 MB/s) - ‘tutorial1/WDs_T2.csv’ saved [562050/562050]

</pre></div></div>
</div>
</section>
<section id="Fine-Mapping">
<h2>Fine Mapping<a class="headerlink" href="#Fine-Mapping" title="Permalink to this headline"></a></h2>
<section id="Train-SC2Spa-with-the-genes-selected-based-on-Wassertain-distance">
<h3>Train SC2Spa with the genes selected based on Wassertain distance<a class="headerlink" href="#Train-SC2Spa-with-the-genes-selected-based-on-Wassertain-distance" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Download Pretrained Model</span>
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38938871<span class="w"> </span>-O<span class="w"> </span>tutorial1/SI_T2_WD.h5
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2023-03-13 13:37:08--  https://figshare.com/ndownloader/files/38938871
Resolving figshare.com (figshare.com)... 54.194.194.40, 63.35.25.157, 2a05:d018:1f4:d000:f9b:6c1a:bd62:eb42, ...
Connecting to figshare.com (figshare.com)|54.194.194.40|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-tempfiles/38938871/SI_T2_WD.h5?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230313/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230313T123708Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=d606a69fad03d628111274b12094cadca3282430cd772e704fa7846523e6d184 [following]
--2023-03-13 13:37:08--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-tempfiles/38938871/SI_T2_WD.h5?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230313/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230313T123708Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=d606a69fad03d628111274b12094cadca3282430cd772e704fa7846523e6d184
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.90.35, 52.218.120.16, 52.218.88.11, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.90.35|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1016306424 (969M) [application/octet-stream]
Saving to: ‘tutorial1/SI_T2_WD.h5’

tutorial1/SI_T2_WD. 100%[===================&gt;] 969.22M  21.7MB/s    in 46s

2023-03-13 13:37:55 (21.1 MB/s) - ‘tutorial1/SI_T2_WD.h5’ saved [1016306424/1016306424]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Set random generator seed</span>
<span class="n">seed_num</span> <span class="o">=</span> <span class="mi">2023</span>
<span class="n">seed</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>
<span class="n">set_seed</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Finely map single cells to spatial locations.</span>
<span class="sd">A model will be trained and saved to `root+name+&#39;.h5&#39;` if model_path is None and save is True.</span>
<span class="sd">The predicted coordinates of single cells will be saved in adata_query.obsm[&#39;spatial_mapping&#39;]</span>
<span class="sd">The predicted coordinates of beads will be saved in adata_ref.obsm[&#39;spatial_mapping&#39;]</span>
<span class="sd">Fine mapping information will be saved in adata_ref.obs[&#39;FM&#39;] and adata_query.obs[&#39;FM&#39;]. True if a cell/bead</span>
<span class="sd">was mapped, otherwise False.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">sta = time()</span>

<span class="sd">neighbors, dis = SI.FineMapping(adata_ref, adata_query, sparse =True, JGs = None,</span>
<span class="sd">                                model_path = None, root = &#39;Model_SI/&#39;,</span>
<span class="sd">                                name = &#39;SI_T2&#39;, l1_reg = 1e-5, l2_reg = 0, dropout = 0.05, epoch = 500,</span>
<span class="sd">                                batch_size = 4096, nodes = [4096, 1024, 256, 64, 16, 4], lrr_patience = 20,</span>
<span class="sd">                                ES_patience = 50, min_lr = 1e-5, save = True, polar = True,</span>
<span class="sd">                                n_neighbors = 1000, dis_cutoff = 20, seed = seed_num)</span>

<span class="sd">end = time()</span>
<span class="sd">print((end - sta) / 60.0, &#39;min&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">SI</span><span class="o">.</span><span class="n">FineMapping</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span> <span class="n">JGs</span> <span class="o">=</span> <span class="n">JGs</span><span class="p">,</span> <span class="n">sparse</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/SI_T2_WD.h5&#39;</span><span class="p">,</span> <span class="n">polar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
               <span class="n">n_layer_cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">cell_radius</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
               <span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">dis_cutoff</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">seed_num</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
n of Referece Genes: 20527
n of Target Genes: 24509
n of Selected Genes: 19577
(35349, 19577)
(127165, 19577)
1875/1875 [==============================] - 11s 6ms/step
1875/1875 [==============================] - 10s 5ms/step
224/224 [==============================] - 1s 6ms/step
1105/1105 [==============================] - 6s 6ms/step
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(127165, 24509)
91395
50305
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Distribution of the number of cells assigned to ST beads</span>
<span class="n">ST_beads_n_cells</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ClosestBead_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s1">&#39;Recon_scST&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ST_beads_n_cells</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="n">ST_beads_n_cells</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    7435
2    5375
3    4160
4    3045
5    1492
Name: Recon_scST, dtype: int64
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_16_2.png" src="../_images/Tutorial_Tutorial_SI_1_16_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.20411143906888
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_17_2.png" src="../_images/Tutorial_Tutorial_SI_1_17_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9.549904097512217
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_18_2.png" src="../_images/Tutorial_Tutorial_SI_1_18_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">SI</span><span class="o">.</span><span class="n">FineMapping</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function FineMapping in module SC2Spa.SI:

FineMapping(adata_ref, adata_query, sparse=True, model_path=None, WD_cutoff=None, JGs=None, root=&#39;Model_SI/&#39;, name=&#39;SI&#39;, l1_reg=1e-05, l2_reg=0, dropout=0.05, epoch=500, batch_size=4096, nodes=[4096, 1024, 256, 64, 16, 4], lrr_patience=20, ES_patience=50, min_lr=1e-05, save=True, polar=True, FM=True, n_layer_cell=[1, 4], cell_radius=5, n_neighbors=1000, dis_cutoff=15, seed=2023)
    1. Finely map single cells to spatial locations.
    A model will be trained and saved to `root+name+&#39;.h5&#39;` if model_path is None and save is True.
    The predicted coordinates of single cells will be saved in adata_query.obsm[&#39;spatial_mapping&#39;]
    The predicted coordinates of beads will be saved in adata_ref.obsm[&#39;spatial_mapping&#39;]
    Fine mapping information will be saved in adata_ref.obs[&#39;FM&#39;] and adata_query.obs[&#39;FM&#39;]. True if a cell/bead
    was mapped, otherwise False.

    2. Reconstruct ST data at single cell resolution
    adata_query.obs[&#39;Dis2CloestBead&#39;] stores the distance between a cell and the ST bead closest to it
    adata_query.obs[&#39;Recon_scST&#39;] marks the cells that are used to reconstruct single-cell ST data
    adata_query.obs[&#39;Recon_scST_layer&#39;] stores which reconstruction layer of cells. -1 means
    a cell is not assigned to any ST bead. 0 means a cell is among the closest cells to a ST bead.
    The greater the layer number, the further a cell is to the center of a ST bead.

    Parameters
    ----------
    adata_ref
        Reference anndata object. Gene expression matrix should be the shape of (cell, gene).
        Spatial information should be stored in adata_ref.obsm[&#39;spatial&#39;] in `np.array` format
    adata_query
        Query anndata object. Gene expression matrix should be the shape of (cell, gene).
    sparse
        if gene expression is saved in sparse format
    model_path
        The path of a trained model. If not None, parameters for training will be ignored.
    WD_cutoff
        genes with Wasserstein distance lower than the cutoff will be used for mapping
    JGs
        List of genes used for training
    root
        the root path to save the model
    name
        the name used to save the model
    l1_reg
        l1 regularization factor
    l2_reg
        l2 regularization factor
    nodes
        a list that contains the numbers of the nodes of hidden layers
    lrr_patience
        The patience for learning rate reduction
    min_lr
        minimum learning rate
    ES_patience
        The patience for early stopping
    n_neighbors
        Number of the nearest neighbors of a bead or cell. This parameter is for
        the KNN algorithm
    dis_cutoff
        Limit for the distance between a single cell and a ST bead. In the process
         of fine mapping. Only the cells within the cutoff will be retained.
    FM
        Perform fine mapping and reconstruct ST data at single cell resolution if True
    seed
        seed for reconstructing the single-cell ST data

</pre></div></div>
</div>
<section id="Visualization">
<h4>Visualization<a class="headerlink" href="#Visualization" title="Permalink to this headline"></a></h4>
<p>Draw Fine mapping result</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#for CT in adata_query.obs[&#39;simp_name&#39;].unique():</span>
<span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA2 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Dentate Principal cells&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transfer:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT1</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial_mapping&#39;</span><span class="p">,</span>
                <span class="n">CT</span> <span class="o">=</span> <span class="n">CT</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;simp_name&#39;</span><span class="p">,</span> <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scST</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid2/&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;SC2HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA1 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_21_1.png" src="../_images/Tutorial_Tutorial_SI_1_21_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA2 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_21_3.png" src="../_images/Tutorial_Tutorial_SI_1_21_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA3 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_21_5.png" src="../_images/Tutorial_Tutorial_SI_1_21_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
Dentate Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_21_7.png" src="../_images/Tutorial_Tutorial_SI_1_21_7.png" />
</div>
</div>
<p>Draw Reconstructed single-cell ST data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA2 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Dentate Principal cells&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transfer:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT1</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial_mapping&#39;</span><span class="p">,</span>
                <span class="n">CT</span> <span class="o">=</span> <span class="n">CT</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;simp_name&#39;</span><span class="p">,</span> <span class="n">FM</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scST</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid2/&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;SC2HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA1 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_23_1.png" src="../_images/Tutorial_Tutorial_SI_1_23_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA2 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_23_3.png" src="../_images/Tutorial_Tutorial_SI_1_23_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA3 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_23_5.png" src="../_images/Tutorial_Tutorial_SI_1_23_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
Dentate Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_23_7.png" src="../_images/Tutorial_Tutorial_SI_1_23_7.png" />
</div>
</div>
<p>Draw reference ST data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1Pc&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3Pc&#39;</span><span class="p">,</span>
           <span class="s1">&#39;DPc&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transfer:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT1</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial&#39;</span><span class="p">,</span>
                <span class="n">CT</span> <span class="o">=</span> <span class="n">CT</span><span class="p">,</span> <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scST</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;SSV2&#39;</span><span class="p">,</span>
                <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid2/&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA1Pc
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_25_1.png" src="../_images/Tutorial_Tutorial_SI_1_25_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA3Pc
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_25_3.png" src="../_images/Tutorial_Tutorial_SI_1_25_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
DPc
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_25_5.png" src="../_images/Tutorial_Tutorial_SI_1_25_5.png" />
</div>
</div>
</section>
</section>
<section id="Train-SC2Spa-with-all-genes-shared-by-the-single-cell-and-spatial-transcriptomic-data">
<h3>Train SC2Spa with all genes shared by the single-cell and spatial transcriptomic data<a class="headerlink" href="#Train-SC2Spa-with-all-genes-shared-by-the-single-cell-and-spatial-transcriptomic-data" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Download Pretrained Model</span>
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38940521<span class="w"> </span>-O<span class="w"> </span>tutorial1/SI_T2.h5
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2023-01-24 19:34:28--  https://figshare.com/ndownloader/files/38940521
Resolving figshare.com (figshare.com)... 54.229.244.39, 52.51.33.13, 2a05:d018:1f4:d000:a2bd:ffac:4123:16e9, ...
Connecting to figshare.com (figshare.com)|54.229.244.39|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38940521/SI_T2.h5?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T183428Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=f0088c8e6d73948f9c2bf9e6f8ebb311c3398b5d4b4ce396c540c04783237828 [following]
--2023-01-24 19:34:28--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38940521/SI_T2.h5?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230124/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230124T183428Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=f0088c8e6d73948f9c2bf9e6f8ebb311c3398b5d4b4ce396c540c04783237828
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.104.234, 52.218.108.19, 52.218.60.35, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.104.234|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1036409592 (988M) [application/octet-stream]
Saving to: ‘SI_T2.h5’

SI_T2.h5            100%[===================&gt;] 988.40M  30.3MB/s    in 38s

2023-01-24 19:35:06 (26.2 MB/s) - ‘SI_T2.h5’ saved [1036409592/1036409592]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Set random generator seed</span>
<span class="n">seed_num</span> <span class="o">=</span> <span class="mi">2022</span>
<span class="n">seed</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>
<span class="n">set_seed</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>

<span class="n">SI</span><span class="o">.</span><span class="n">FineMapping</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span> <span class="n">JGs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sparse</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/SI_T2.h5&#39;</span><span class="p">,</span> <span class="n">polar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">n_layer_cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">cell_radius</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                <span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">dis_cutoff</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">seed_num</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
n of Referece Genes: 20527
n of Target Genes: 24509
n of Selected Genes: 19986
(35349, 19986)
(127165, 19986)
1875/1875 [==============================] - 11s 6ms/step
1875/1875 [==============================] - 11s 6ms/step
224/224 [==============================] - 2s 6ms/step
1105/1105 [==============================] - 6s 6ms/step
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(127165, 24509)
87791
42853
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Distribution of the number of cells assigned to ST beads</span>
<span class="n">ST_beads_n_cells</span> <span class="o">=</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ClosestBead_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s1">&#39;Recon_scST&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ST_beads_n_cells</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="n">ST_beads_n_cells</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    6885
2    4375
3    3212
4    2468
5    1542
Name: Recon_scST, dtype: int64
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_30_2.png" src="../_images/Tutorial_Tutorial_SI_1_30_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.165554845814355
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_31_2.png" src="../_images/Tutorial_Tutorial_SI_1_31_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Recon_scST_layer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer</span><span class="p">][</span><span class="s1">&#39;Dis2ClosestBead&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9.559654472244024
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_32_2.png" src="../_images/Tutorial_Tutorial_SI_1_32_2.png" />
</div>
</div>
<section id="id1">
<h4>Visualization<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<p>Draw Fine mapping result</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Location of single cells predicted by SC2Spa</span>

<span class="c1">#for CT in adata_query.obs[&#39;simp_name&#39;].unique():</span>
<span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA2 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Dentate Principal cells&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transfer:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT1</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial_mapping&#39;</span><span class="p">,</span>
                <span class="n">CT</span> <span class="o">=</span> <span class="n">CT</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;simp_name&#39;</span><span class="p">,</span> <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scST</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid2/&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;SC2HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA1 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_34_1.png" src="../_images/Tutorial_Tutorial_SI_1_34_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA2 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_34_3.png" src="../_images/Tutorial_Tutorial_SI_1_34_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA3 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_34_5.png" src="../_images/Tutorial_Tutorial_SI_1_34_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
Dentate Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_34_7.png" src="../_images/Tutorial_Tutorial_SI_1_34_7.png" />
</div>
</div>
<p>Draw reconstructed single-cell ST data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA2 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Dentate Principal cells&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transfer:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT1</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial_mapping&#39;</span><span class="p">,</span>
                <span class="n">CT</span> <span class="o">=</span> <span class="n">CT</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;simp_name&#39;</span><span class="p">,</span> <span class="n">FM</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scST</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid2/&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;SC2HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA1 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_36_1.png" src="../_images/Tutorial_Tutorial_SI_1_36_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA2 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_36_3.png" src="../_images/Tutorial_Tutorial_SI_1_36_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA3 Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_36_5.png" src="../_images/Tutorial_Tutorial_SI_1_36_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
Dentate Principal cells
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_36_7.png" src="../_images/Tutorial_Tutorial_SI_1_36_7.png" />
</div>
</div>
<p>Draw reference ST data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># True location of ST voxels. ST voxels were annotated by RCTD</span>

<span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1Pc&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3Pc&#39;</span><span class="p">,</span>
           <span class="s1">&#39;DPc&#39;</span><span class="p">]</span>

<span class="c1">#for CT in adata_ref.obs[&#39;celltype_1&#39;].unique():</span>
<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transfer:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT1</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial&#39;</span><span class="p">,</span>
                <span class="n">CT</span> <span class="o">=</span> <span class="n">CT</span><span class="p">,</span> <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;SSV2&#39;</span><span class="p">,</span>
                <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid2/&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA1Pc
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_38_1.png" src="../_images/Tutorial_Tutorial_SI_1_38_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
CA3Pc
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_38_3.png" src="../_images/Tutorial_Tutorial_SI_1_38_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
****************
DPc
****************
Transfer:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_38_5.png" src="../_images/Tutorial_Tutorial_SI_1_38_5.png" />
</div>
</div>
</section>
</section>
</section>
<section id="Imputation">
<h2>Imputation<a class="headerlink" href="#Imputation" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">:[</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">]})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">n_colors</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span><span class="n">start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">as_cmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">])</span>
<span class="n">pl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial1/Transfer2/colorbar.png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans.
findfont: Generic family &#39;sans-serif&#39; not found because none of the following families were found: Helvetica
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_40_1.png" src="../_images/Tutorial_Tutorial_SI_1_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sta</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="n">neighbors</span><span class="p">,</span> <span class="n">dis</span> <span class="o">=</span> <span class="n">SI</span><span class="o">.</span><span class="n">NRD_CT_preprocess</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span>
                                      <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dis_cutoff</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">SI</span><span class="o">.</span><span class="n">NRD_CT</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">dis</span><span class="p">,</span> <span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span>
          <span class="n">ct_name</span> <span class="o">=</span> <span class="s1">&#39;simp_name&#39;</span><span class="p">,</span> <span class="n">weight_constant</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exclude_CTs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">])</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">sta</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;min(s)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6364392717679341 min(s)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw cell type proportion of ST voxels inferred based on SC2Spa&#39;s prediction</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">n_colors</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span><span class="n">start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">as_cmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">CT_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA1 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA2 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CA3 Principal cells&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Dentate Principal cells&#39;</span><span class="p">]</span>

<span class="c1">#for CT in adata_query.obs[&#39;simp_name&#39;].unique():</span>
<span class="k">for</span> <span class="n">CT</span> <span class="ow">in</span> <span class="n">CT_list</span><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span><span class="n">CT</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">]):</span>
        <span class="k">continue</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawCT2</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial&#39;</span><span class="p">,</span> <span class="n">NRD</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">root</span><span class="o">=</span><span class="s1">&#39;tutorial1/Transfer2/FM_NRD/&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;SC2HC1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans.
findfont: Generic family &#39;sans-serif&#39; not found because none of the following families were found: Helvetica
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CA1 Principal cells
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_42_2.png" src="../_images/Tutorial_Tutorial_SI_1_42_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CA2 Principal cells
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_42_4.png" src="../_images/Tutorial_Tutorial_SI_1_42_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CA3 Principal cells
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_42_6.png" src="../_images/Tutorial_Tutorial_SI_1_42_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dentate Principal cells
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_42_8.png" src="../_images/Tutorial_Tutorial_SI_1_42_8.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Impute gene expression of ST voxels</span>
<span class="n">sta</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="n">adata_impute</span> <span class="o">=</span> <span class="n">SI</span><span class="o">.</span><span class="n">NRD_impute</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">dis</span><span class="p">,</span> <span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span>
                             <span class="n">ct_name</span><span class="o">=</span><span class="s1">&#39;simp_name&#39;</span><span class="p">,</span> <span class="n">weight_constant</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exclude_CTs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">])</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">sta</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;min(s)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/linbuliao/anaconda3/lib/python3.9/site-packages/SC2Spa/SI.py:1040: FutureWarning: X.dtype being converted to np.float32 from float64. In the next version of anndata (0.9) conversion will not be automatic. Pass dtype explicitly to avoid this warning. Pass `AnnData(X, dtype=X.dtype, ...)` to get the future behavour.
  adata_impute = anndata.AnnData(X=X_impute,
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.5107293883959452 min(s)
</pre></div></div>
</div>
</section>
<section id="Spatially-Variable-Genes">
<h2>Spatially Variable Genes<a class="headerlink" href="#Spatially-Variable-Genes" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rank genes according to their contribution to location prediction.</span>
<span class="c1"># The location predictive genes are spatial variable</span>
<span class="n">JGs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">adata_ref</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">var_names</span><span class="p">))))</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">adata_ref</span><span class="p">[:,</span> <span class="n">JGs</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SI</span><span class="o">.</span><span class="n">Self_Mapping</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">sparse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/SI_T2.h5&#39;</span><span class="p">)</span>

<span class="n">SVA</span><span class="o">.</span><span class="n">PrioritizeLPG</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">model</span><span class="p">,</span> <span class="n">percent</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">scale_factor</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
                  <span class="n">Norm</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;imp_sumup_norm&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1105/1105 [==============================] - 6s 6ms/step
&lt;keras.layers.core.dense.Dense object at 0x7f85ee5438b0&gt; :
(4, 2)
&lt;keras.layers.core.dense.Dense object at 0x7f85edb7ff40&gt; :
(16, 4)
&lt;keras.layers.core.dense.Dense object at 0x7f85edb69970&gt; :
(64, 16)
&lt;keras.layers.core.dense.Dense object at 0x7f85ee5454f0&gt; :
(256, 64)
&lt;keras.layers.core.dense.Dense object at 0x7f85eea5e910&gt; :
(1024, 256)
&lt;keras.layers.core.dense.Dense object at 0x7f85eea50fa0&gt; :
(4096, 1024)
&lt;keras.layers.core.dense.Dense object at 0x7f85edb783d0&gt; :
(19986, 4096)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_cells</th>
      <th>mt</th>
      <th>ERCC</th>
      <th>n_cells_by_counts</th>
      <th>mean_counts</th>
      <th>pct_dropout_by_counts</th>
      <th>total_counts</th>
      <th>imp_sumup</th>
      <th>imp_sumup_norm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>TTR</th>
      <td>13069</td>
      <td>False</td>
      <td>False</td>
      <td>13069</td>
      <td>4.758839</td>
      <td>67.090552</td>
      <td>188983.0</td>
      <td>1.477345</td>
      <td>1.262538</td>
    </tr>
    <tr>
      <th>TSHZ2</th>
      <td>2603</td>
      <td>False</td>
      <td>False</td>
      <td>2603</td>
      <td>0.105535</td>
      <td>93.445306</td>
      <td>4191.0</td>
      <td>1.253887</td>
      <td>1.071571</td>
    </tr>
    <tr>
      <th>PCP4</th>
      <td>21317</td>
      <td>False</td>
      <td>False</td>
      <td>21317</td>
      <td>1.950670</td>
      <td>46.321011</td>
      <td>77465.0</td>
      <td>1.197442</td>
      <td>1.023334</td>
    </tr>
    <tr>
      <th>SST</th>
      <td>2943</td>
      <td>False</td>
      <td>False</td>
      <td>2943</td>
      <td>0.229452</td>
      <td>92.589142</td>
      <td>9112.0</td>
      <td>1.075541</td>
      <td>0.919156</td>
    </tr>
    <tr>
      <th>CALB2</th>
      <td>3967</td>
      <td>False</td>
      <td>False</td>
      <td>3967</td>
      <td>0.193392</td>
      <td>90.010576</td>
      <td>7680.0</td>
      <td>0.998086</td>
      <td>0.852964</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">n_colors</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span><span class="n">start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">as_cmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">VizCus</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x_name</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_name</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">c_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_name</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y_name</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">vmin</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_name</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y_name</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c_name</span><span class="p">],</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_name</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y_name</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c_name</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">save</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span>
                    <span class="n">dpi</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This step is time consuming. Let&#39;s download precalculated stats file</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">from scipy import stats</span>
<span class="sd">from IPython.display import clear_output</span>

<span class="sd">JCs = sorted(list(set(adata_ref.obs_names).intersection(set(adata_impute.obs_names))))</span>

<span class="sd">pearson_JGs = pd.DataFrame(np.zeros((len(JGs), 3)), columns = [&#39;gene&#39;, &#39;pearson_r&#39;, &#39;p&#39;])</span>
<span class="sd">pearson_JGs[&#39;gene&#39;] = JGs</span>

<span class="sd">for i, JG in enumerate(JGs):</span>
<span class="sd">    print(i)</span>
<span class="sd">    t = stats.pearsonr(adata_impute[JCs, JG].X.flatten(), adata_ref[JCs, JG].X.toarray().flatten())</span>
<span class="sd">    pearson_JGs.loc[i, &#39;pearson_r&#39;] = t[0]</span>
<span class="sd">    pearson_JGs.loc[i, &#39;p&#39;] = t[1]</span>
<span class="sd">    clear_output(wait = True)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">sc.pp.calculate_qc_metrics(adata, percent_top=None, log1p=False, inplace=True)</span>
<span class="sd">adata.var[&#39;percent_cell&#39;] = adata.var[&#39;n_cells_by_counts&#39;] / adata.shape[0]</span>

<span class="sd">t = adata.var[[&#39;percent_cell&#39;, &#39;imp_sumup_norm&#39;]].reset_index()</span>
<span class="sd">t.columns =[&#39;gene&#39;, &#39;percent_cell&#39;, &#39;imp_sumup_norm&#39;]</span>
<span class="sd">pearson_JGs = pearson_JGs.merge(t, how = &#39;left&#39;)</span>

<span class="sd">pearson_JGs.sort_values(&#39;pearson_r&#39;, ascending = False).to_csv(&#39;tutorial1/Transfer2/T2_stats.csv&#39;, index = None)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Download precalculated stats file</span>
<span class="o">!</span>wget<span class="w"> </span>https://figshare.com/ndownloader/files/38940998<span class="w"> </span>-O<span class="w"> </span>tutorial1/Transfer2/T2_stats.csv
<span class="n">pearson_JGs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;tutorial1/Transfer2/T2_stats.csv&#39;</span><span class="p">)</span>
<span class="n">pearson_JGs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pearson_r&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2023-03-13 16:09:27--  https://figshare.com/ndownloader/files/38940998
Resolving figshare.com (figshare.com)... 34.240.113.119, 63.35.25.157, 2a05:d018:1f4:d003:7ace:9580:fd83:b0a0, ...
Connecting to figshare.com (figshare.com)|34.240.113.119|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38940998/T2_stats.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230313/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230313T150927Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=98b04a2f13394b224bd495ef32fd5b96dbf5e3213281c0e4c127d7c2f73c69a6 [following]
--2023-03-13 16:09:27--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/38940998/T2_stats.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20230313/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20230313T150927Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=98b04a2f13394b224bd495ef32fd5b96dbf5e3213281c0e4c127d7c2f73c69a6
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.85.115, 52.218.29.19, 52.92.35.32, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.85.115|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1615739 (1.5M) [text/csv]
Saving to: ‘tutorial1/Transfer2/T2_stats.csv’

tutorial1/Transfer2 100%[===================&gt;]   1.54M  6.30MB/s    in 0.2s

2023-03-13 16:09:27 (6.30 MB/s) - ‘tutorial1/Transfer2/T2_stats.csv’ saved [1615739/1615739]

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gene</th>
      <th>pearson_r</th>
      <th>p</th>
      <th>percent_cell</th>
      <th>imp_sumup_norm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>HPCA</td>
      <td>0.403153</td>
      <td>0.000000e+00</td>
      <td>0.417636</td>
      <td>0.772095</td>
    </tr>
    <tr>
      <th>1</th>
      <td>C1QL2</td>
      <td>0.375441</td>
      <td>0.000000e+00</td>
      <td>0.031627</td>
      <td>0.226433</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6030445D17RIK</td>
      <td>0.360912</td>
      <td>0.000000e+00</td>
      <td>0.000283</td>
      <td>0.002228</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NRGN</td>
      <td>0.321082</td>
      <td>2.395553e-271</td>
      <td>0.377210</td>
      <td>0.755274</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FIBCD1</td>
      <td>0.307258</td>
      <td>1.685399e-247</td>
      <td>0.033579</td>
      <td>0.111303</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TSHZ2</td>
      <td>0.302188</td>
      <td>4.506501e-239</td>
      <td>0.069252</td>
      <td>1.071571</td>
    </tr>
    <tr>
      <th>6</th>
      <td>PPP3CA</td>
      <td>0.298777</td>
      <td>1.695301e-233</td>
      <td>0.451837</td>
      <td>0.485366</td>
    </tr>
    <tr>
      <th>7</th>
      <td>CPNE6</td>
      <td>0.289595</td>
      <td>7.320895e-219</td>
      <td>0.117457</td>
      <td>0.326439</td>
    </tr>
    <tr>
      <th>8</th>
      <td>OLFM1</td>
      <td>0.277887</td>
      <td>5.583135e-201</td>
      <td>0.469150</td>
      <td>0.482522</td>
    </tr>
    <tr>
      <th>9</th>
      <td>HS3ST4</td>
      <td>0.276645</td>
      <td>3.930274e-199</td>
      <td>0.091148</td>
      <td>0.423905</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VizCus</span><span class="p">(</span><span class="n">pearson_JGs</span><span class="p">,</span> <span class="n">x_name</span> <span class="o">=</span> <span class="s1">&#39;imp_sumup_norm&#39;</span><span class="p">,</span> <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Contribution to Location Prediction&#39;</span><span class="p">,</span>
       <span class="n">y_name</span> <span class="o">=</span> <span class="s1">&#39;pearson_r&#39;</span><span class="p">,</span> <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;pearson_r&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;percent_cell&#39;</span><span class="p">,</span>
       <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2_imp_r_pcell.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans.
findfont: Generic family &#39;sans-serif&#39; not found because none of the following families were found: Helvetica
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_50_1.png" src="../_images/Tutorial_Tutorial_SI_1_50_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">n_colors</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span><span class="n">start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">as_cmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">GLs</span> <span class="o">=</span> <span class="n">pearson_JGs</span><span class="p">[</span><span class="n">pearson_JGs</span><span class="p">[</span><span class="s1">&#39;percent_cell&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pearson_r&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;gene&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>

<span class="n">GLs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">GLs</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">4</span>

<span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">GLs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">32</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">gene</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">32</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;scRNAseq:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawGenes2</span><span class="p">(</span><span class="n">adata_query</span><span class="p">,</span> <span class="n">gene</span> <span class="o">=</span> <span class="n">gene</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial_mapping&#39;</span><span class="p">,</span>
                   <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">650</span><span class="p">,</span> <span class="mi">5750</span><span class="p">],</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">650</span><span class="p">,</span> <span class="mi">5750</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span>
                   <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">CTL</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;simp_name&#39;</span><span class="p">,</span>
                   <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid1/&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;AMB&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ST:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawGenes2</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">gene</span> <span class="o">=</span> <span class="n">gene</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial&#39;</span><span class="p">,</span>
                   <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">650</span><span class="p">,</span> <span class="mi">5750</span><span class="p">],</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">650</span><span class="p">,</span> <span class="mi">5750</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span>
                   <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">CTL</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;SSV2&#39;</span><span class="p">,</span>
                   <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid1/&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;HC1&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Imputed ST:&#39;</span><span class="p">)</span>
    <span class="n">Vis</span><span class="o">.</span><span class="n">DrawGenes2</span><span class="p">(</span><span class="n">adata_impute</span><span class="p">,</span> <span class="n">gene</span> <span class="o">=</span> <span class="n">gene</span><span class="p">,</span> <span class="n">lim</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">coords_name</span> <span class="o">=</span> <span class="s1">&#39;spatial&#39;</span><span class="p">,</span>
                   <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">650</span><span class="p">,</span> <span class="mi">5750</span><span class="p">],</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">650</span><span class="p">,</span> <span class="mi">5750</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span>
                   <span class="n">FM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">CTL</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="s1">&#39;SSV2&#39;</span><span class="p">,</span>
                   <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;tutorial1/Transfer2/FM_Valid1/&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;HC1_Impute&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
NRGN
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_1.png" src="../_images/Tutorial_Tutorial_SI_1_51_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_3.png" src="../_images/Tutorial_Tutorial_SI_1_51_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_5.png" src="../_images/Tutorial_Tutorial_SI_1_51_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
PPP3CA
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_7.png" src="../_images/Tutorial_Tutorial_SI_1_51_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_9.png" src="../_images/Tutorial_Tutorial_SI_1_51_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_11.png" src="../_images/Tutorial_Tutorial_SI_1_51_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
HPCA
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_13.png" src="../_images/Tutorial_Tutorial_SI_1_51_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_15.png" src="../_images/Tutorial_Tutorial_SI_1_51_15.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_17.png" src="../_images/Tutorial_Tutorial_SI_1_51_17.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
FIBCD1
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_19.png" src="../_images/Tutorial_Tutorial_SI_1_51_19.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_21.png" src="../_images/Tutorial_Tutorial_SI_1_51_21.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_23.png" src="../_images/Tutorial_Tutorial_SI_1_51_23.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
PROX1
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_25.png" src="../_images/Tutorial_Tutorial_SI_1_51_25.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_27.png" src="../_images/Tutorial_Tutorial_SI_1_51_27.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_29.png" src="../_images/Tutorial_Tutorial_SI_1_51_29.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
C1QL2
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_31.png" src="../_images/Tutorial_Tutorial_SI_1_51_31.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_33.png" src="../_images/Tutorial_Tutorial_SI_1_51_33.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_35.png" src="../_images/Tutorial_Tutorial_SI_1_51_35.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
HS3ST4
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_37.png" src="../_images/Tutorial_Tutorial_SI_1_51_37.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_39.png" src="../_images/Tutorial_Tutorial_SI_1_51_39.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_41.png" src="../_images/Tutorial_Tutorial_SI_1_51_41.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
OLFM1
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_43.png" src="../_images/Tutorial_Tutorial_SI_1_51_43.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_45.png" src="../_images/Tutorial_Tutorial_SI_1_51_45.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_47.png" src="../_images/Tutorial_Tutorial_SI_1_51_47.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
CPNE6
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_49.png" src="../_images/Tutorial_Tutorial_SI_1_51_49.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_51.png" src="../_images/Tutorial_Tutorial_SI_1_51_51.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_53.png" src="../_images/Tutorial_Tutorial_SI_1_51_53.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
********************************
TSHZ2
********************************
scRNAseq:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_55.png" src="../_images/Tutorial_Tutorial_SI_1_51_55.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ST:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_57.png" src="../_images/Tutorial_Tutorial_SI_1_51_57.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imputed ST:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Tutorial_Tutorial_SI_1_51_59.png" src="../_images/Tutorial_Tutorial_SI_1_51_59.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../Tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Linbu Liao and Won lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>